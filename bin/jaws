#!/usr/bin/env node

'use strict';

var JawsError = require('../lib/jaws-error'),
    JAWS = require('../lib/index.js'),
    program = require('commander');

function handleExit(promise) {
  promise
      .catch(JawsError, function(e) {
        console.error(e);
        process.exit(e.messageId);
      })
      .error(function(e) {
        console.error(e);
        process.exit(1);
      });
}

program
    .version(JAWS._meta.version);

program
    .command('new')
    .description('Create a new JAWS project in the current working directory')
    .action(function() {
      handleExit(JAWS.new());
    });

program
    .command('install <url>')
    .description('Installs an jaws-module')
    .action(function(url) {
      handleExit(JAWS.install(url));
    });

program
    .command('tag')
    .description('Tag a lambda function to be deployed')
    .action(function() {
      handleExit(JAWS.tag());
    });

program
    .command('*')
    .action(function() {
      handleExit(JAWS.custom(arguments));
    });

program.parse(process.argv);
