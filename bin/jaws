#!/usr/bin/env node

'use strict';

var JawsError = require('../lib/jaws-error'),
    JAWS = require('../lib/index.js'),
    program = require('commander'),
    handleExit = require('../lib/utils').handleExit;

program
    .version(JAWS._meta.version);

//TODO: need to provide cli options/env vars to bypass input
program
    .command('new')
    .description('Creates a new JAWS project in the current working directory and creates an AWS CloudFormation ' +
    'stack which provisions essential AWS resources for your JAWS project.')
    .option('-n, --proj-name <name>', 'Project name')
    .option('-s, --stage <stage>', 'Stage to create')
    .option('-r, --lambda-region <region>', 'Region lambda(s) will be created in')
    .option('-e, --notification-email <email>', 'Email to be notified with stack alerts')
    .option('-p, --profile <profile name>', 'AWS profile to use (as defined in ~/.aws/credentials)')
    .action(function(options) {
      console.log('options', options);
      handleExit(JAWS.new(
          options['proj-name'],  //name is reserved in commander...
          options.stage,
          options['lambda-region'],
          options['notification-email'],
          options.profile
      ));
    });

program
    .command('install <url>')
    .description('Installs a jaws-module from the specified url into the apprpriate area of your JAWS project.')
    .option('-s, --save', 'Save jaws-module\'s CloudFormation and Swagger Template to your project\'s')
    .action(function(url, options) {
      handleExit(JAWS.install(url, options.save));
    });

program
    .command('tag')
    .description('Tag a lambda function to be deployed the next time you run the deploy command for all' +
    ' tagged lambdas.')
    .action(function() {
      handleExit(JAWS.tag());
    });

program
    .command('provision <stage>')
    .description('Triggers a CloudFormation Stack Update for the specified stage.')
    .action(function() {
      handleExit(JAWS.provision());
    });

program
    .command('logs <stage>')
    .description('Get logs for the lambda function in the specified stage in your current working directory.')
    .action(function(stage) {
      handleExit(JAWS.logs(stage));
    });

program
    .command('*')
    .description('Handles custom commands.')
    .action(function() {
      handleExit(JAWS.custom(arguments));
    });

if (process.argv.length == 2) {
  program.outputHelp();
} else {
  program.parse(process.argv);
}
