var app_defaults={environment:$("#dashboard-container").attr("data-environment"),client_id:$("#dashboard-container").attr("data-clientid"),host:window.location.host,protocol:"http"};angular.module("appDashboard",["ngResource","ui.router"]),angular.module("appDashboard").run(["$rootScope","$timeout","$interval","$state","ServantAngularService","Application",function(e,t,r,n,a,s){e.s={},e.$on("$stateChangeError",function(t,r,a,i,s,o){switch(e.s.loading=!1,o){case"no_subscription":return n.go("plan",a);case"no_number":return n.go("number",a);default:return n.go("servants")}}),e.s.initializeServantSDK=function(){var e={application_client_id:$("#dashboard-container").attr("data-clientid"),protocol:window.location.host.indexOf("localhost")>-1?"http":"https"};Servant.initialize(e)},e.s.loadUserAndServants=function(t){s.loadUserAndServants(null,function(r){return e.s.user=r.user,e.s.servants=r.servants,e.s.missing_servants=r.missing_servants,t(null,r)},function(e){return 401===e.status?(window.location="/",!1):t(e,null)})},e.s.setServant=function(t,r){for(i=0;i<e.s.servants.length;i++)e.s.servants[i]._id.toString()===t&&(e.servant_index=i);return a.setServant(e.s.servants[e.servant_index]._id),r()}}]),angular.module("appDashboard").config(["$stateProvider","$urlRouterProvider",function(e,t){t.otherwise("/"),e.state("servants",{url:"/",templateUrl:"views/dashboard/servants.html",resolve:{initializeView:initializeView}}).state("menu",{url:"/:servantID/menu",templateUrl:"views/dashboard/menu.html",resolve:{initializeView:initializeView}})}]);var initializeView=["$q","$rootScope","$state","$stateParams","Application","ServantAngularService",function(e,t,r,n){var a=e.defer();if(t.s.user&&t.s.servants.length){if(n.servantID)for(i=0;i<t.s.servants.length;i++)t.s.servants[i]._id===n.servantID&&(t.s.servant_index=i);return t.s.loading=!0,!0}return t.s.loading=!0,t.s.loadUserAndServants(function(e,r){if(console.log("User and Servant Data Loaded: ",r),t.s.initializeServantSDK(),n.servantID)for(i=0;i<r.servants.length;i++)r.servants[i]._id===n.servantID&&(t.s.servant_index=i);return t.s.loading=!1,a.resolve()}),a.promise}];angular.module("appDashboard").config(["$locationProvider",function(e){e.hashPrefix("!")}]),angular.module("appDashboard").factory("Application",["$resource",function(e){return e("",null,{loadUserAndServants:{method:"GET",isArray:!1,url:"/user_and_servants"}})}]),angular.module("appDashboard").service("ServantAngularService",["$rootScope","$q",function(e,t){this.status=function(){return Servant.status},this.getUserAndServants=function(){var r=t.defer();return Servant.getUserAndServants(e.s.user.servant_access_token,function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.showServant=function(e){var r=t.defer();return Servant.showServant(e,function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.setServant=function(e){var r=t.defer();return Servant.setServant(e),r.resolve(),r.promise},this.initializeUploadableArchetypes=function(e){var r=t.defer();return Servant.initializeUploadableArchetypes(e),r.resolve(),r.promise},this.instantiate=function(e){var r=t.defer();return Servant.instantiate(e,function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.validate=function(e,r){var n=t.defer();return Servant.validate(e,r,function(e,t){e&&n.resolve(e),t&&n.resolve(t)},function(e){n.reject(e)}),n.promise},this.saveArchetype=function(e,r){var n=t.defer();return Servant.saveArchetype(e,r,function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise},this.showArchetype=function(e,r){var n=t.defer();return Servant.showArchetype(e,r,function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise},this.queryArchetypes=function(e,r){var n=t.defer();return Servant.queryArchetypes(e,r,function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise},this.deleteArchetype=function(e,r){var n=t.defer();return Servant.deleteArchetype(e,r,function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise},this.archetypesRecent=function(e,r){var n=t.defer();return Servant.archetypesRecent(e,r,function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise},this.archetypesOldest=function(e,r){var n=t.defer();return Servant.archetypesOldest(e,r,function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise},this.servantpayCharge=function(e){var r=t.defer();return Servant.servantpayCharge(e,function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.servantpaySubscriptionCreate=function(e){var r=t.defer();return Servant.servantpaySubscriptionCreate(e,function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.servantpaySubscriptionUpdate=function(e){var r=t.defer();return Servant.servantpaySubscriptionUpdate(e,function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.servantpaySubscriptionCancel=function(){var e=t.defer();return Servant.servantpaySubscriptionCancel(function(t){e.resolve(t)},function(t){e.reject(t)}),e.promise},this.servantpayCustomerDelete=function(){var e=t.defer();return Servant.servantpayCustomerDelete(function(t){e.resolve(t)},function(t){e.reject(t)}),e.promise}}]);